<div class="ordering">
  <div class="ordering__page-container">
    <div class="lines">
      <div class="line"></div>
      <div class="line"></div>
    </div>
    <div class="ordering__breadcrumbs">
      <a [routerLink]="['/'] | localize" class="ordering__breadcrumbs-item">{{ 'home.name' | translate}}</a>
      <a [routerLink]="['/', 'cart'] | localize" class="ordering__breadcrumbs-item">{{ 'order.name' | translate}}</a>
      <a [routerLink]="['/', 'cart', 'ordering'] | localize"
        class="ordering__breadcrumbs-item">{{ 'personal.ordering' | translate}}</a>
    </div>
    <div class="ordering__page-wrap">
      <section class="ordering__container-left">
        <form id="finalizeOrderForm" [formGroup]="finalizeOrderForm" (ngSubmit)="onSubmit()" novalidate
          class="ordering__form-wrap">
          <div class="ordering-person__form-group" *ngIf="userInfo">
            <h3 class="ordering-person__h3 ordering__h3" #personalDataBlock>
              {{ 'personal.personalData' | translate}}
            </h3>
            <div class="ordering-person__input-wrap">
              <div class="ordering-person__left">
                <div class="ordering-person__name">
                  <p class="ordering-person__name-label">{{ 'personal.yourFName' | translate}}</p>
                </div>
                <div class="ordering-person__number">
                  <p class="ordering-person__number-label">{{ 'personal.yourPhone' | translate}}</p>
                </div>
                <div class="ordering-person__email">
                  <p class="ordering-person__email-label">E-mail</p>
                </div>
              </div>
              <div class="ordering-person__right">
                <div class="ordering-person__name">
                  <p class="ordering-person__name-input">{{userInfo.fName}}</p>
                </div>
                <div class="ordering-person__number">
                  <p class="ordering-person__number-input">+380{{userInfo.phone}}</p>
                </div>
                <div class="ordering-person__email">
                  <p class="ordering-person__email-input">{{userInfo.email}}</p>
                </div>
              </div>
            </div>

          </div>
          <div class="ordering-delivery__form-group">
            <ng-container *ngIf="!addingAddress">
              <h3 class="ordering-delivery__h3 ordering__h3">
                {{ 'personal.delivery' | translate}}
              </h3>
              <div class="ordering-delivery__list">
                <div class="ordering-delivery__item" *ngFor="let item of userAddresses">
                    <span *ngIf="item.confirmed else notConfirmed"
                    class="ordering__confirmed confirmed">{{'addresses.confirmed' | translate}}</span>
                  <ng-template #notConfirmed>
                    <span class="ordering__confirmed notconfirmed">{{'addresses.notconfirmed' | translate}}</span>
                  </ng-template>
                  <div class="ordering__user-wrap">
                    <div class="ordering-delivery__icon" *ngIf="item.addressType == 'f'; else uAddress">
                      <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg"
                        xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 480 480"
                        style="enable-background:new 0 0 480 480;" xml:space="preserve">
                        <g>
                          <path d="M240,0C142.798,0,64,78.798,64,176c0,94.576,162.896,292.712,169.832,301.096c1.52,1.839,3.782,2.904,6.168,2.904
                 c2.386,0,4.648-1.065,6.168-2.904C253.104,468.712,416,270.576,416,176C416,78.798,337.202,0,240,0z M240,459.288
                 C209.896,421.712,80,254.976,80,176c0.101-88.324,71.677-159.899,160-160c88.324,0.101,159.899,71.676,160,160
                 C400,254.96,270.104,421.704,240,459.288z" />
                          <path d="M348.88,145.664l-104-80c-2.877-2.214-6.883-2.214-9.76,0l-104,80c-3.499,2.697-4.149,7.721-1.452,11.22
                 c1.514,1.964,3.852,3.115,6.332,3.116h24v88c0,4.418,3.582,8,8,8h144c4.418,0,8-3.582,8-8v-88h24
                 c4.418-0.002,7.998-3.586,7.996-8.004C351.995,149.516,350.844,147.178,348.88,145.664z M256,240h-32v-48h32V240z M312,144
                 c-4.418,0-8,3.582-8,8v88h-32v-56c0-4.418-3.582-8-8-8h-48c-4.418,0-8,3.582-8,8v56h-32v-88c0-4.418-3.582-8-8-8h-8.48
                 L240,82.096L320.48,144H312z" />
                        </g>
                      </svg>
                    </div>
                    <ng-template #uAddress>
                      <div class="ordering-delivery__icon">
                        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg"
                          xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 416 416"
                          style="enable-background:new 0 0 416 416;" xml:space="preserve">
                          <g>
                            <path d="M388,87.28v0.12H274.52V64.64c-0.022-12.76-10.36-23.098-23.12-23.12h-89.96c-6.128,0.006-12.001,2.453-16.32,6.8
                           c-4.347,4.319-6.794,10.192-6.8,16.32V87.4H28c-15.464,0-28,12.536-28,28v228.96c0.044,16.617,13.503,30.076,30.12,30.12H385.6
                           c16.679,0.11,30.289-13.321,30.399-29.999c0-0.04,0-0.081,0.001-0.121V115.28C416,99.816,403.464,87.28,388,87.28z M149.8,64.64
                           c0.022-6.419,5.221-11.618,11.64-11.64h89.92c6.41,0.044,11.596,5.23,11.64,11.64V87.4H149.8V64.64z M11.6,117.28
                           c0.044-10.276,8.364-18.596,18.64-18.64h355.48c10.276,0.044,18.596,8.364,18.64,18.64l-0.12,112.12
                           c-0.044,9.039-7.361,16.356-16.4,16.4H232v-16.24c0-7.666-6.214-13.88-13.88-13.88h-20.28c-3.655-0.012-7.165,1.427-9.76,4
                           c-2.573,2.595-4.012,6.105-4,9.76v16.24H28c-9.039-0.044-16.356-7.361-16.4-16.4V117.28z M195.32,245.8v-16.24
                           c0.029-0.586,0.27-1.141,0.68-1.56c0.45-0.438,1.053-0.682,1.68-0.68H218c1.326,0,2.4,1.075,2.4,2.4v16.24L195.32,245.8z
                            M220.4,257.28v16.24c0.006,0.628-0.239,1.233-0.68,1.68c-0.447,0.441-1.052,0.686-1.68,0.68h-20.2c-1.326,0-2.4-1.075-2.4-2.4
                           v-16.2H220.4z M404.4,344.36c-0.044,10.276-8.364,18.596-18.64,18.64H30.24c-10.276-0.044-18.596-8.364-18.64-18.64V252
                           c4.767,3.457,10.511,5.307,16.4,5.28h156v16.24c0,7.666,6.214,13.88,13.88,13.88h20.32c3.654,0.007,7.162-1.431,9.76-4
                           c2.569-2.598,4.007-6.106,4-9.76v-16.36h156c5.902,0.035,11.662-1.815,16.44-5.28V344.36z" />
                          </g>
                        </svg>
                      </div>
                    </ng-template>
                    <div>
                      <p class="ordering-delivery__text" (click)="chooseLocation(item, $event)"
                        [class.choosen]="item.id === choosenAddressId">
                        {{item.regionName}} {{'personal.region' | translate }}.,
                        {{'personal.city' | translate }}.{{item.cityName}},
                        {{item.streetName}}, {{item.house}}
                        <ng-container *ngIf="item.apartment">
                          , {{'personal.apartment' | translate }} {{item.apartment}}
                        </ng-container>
                      </p>
                      <div class="ordering__options">
                        <button *ngIf="item.id !== choosenAddressId" (click)="chooseLocation(item, $event)"
                          class="ordering-delivery__delete-btn"
                          [class.choose]="!choosenAddressId">{{'personal.choose' | translate }}</button>
                        <button *ngIf="item.id === choosenAddressId" class="ordering-delivery__delete-btn"
                          [class.choose]="item.id === choosenAddressId">{{'personal.choosen' | translate }}</button>
                        <ng-container *ngIf="item.confirmed && item.addressType == 'f' && fAddressCount > 1">
                          <p *ngIf="item.isDefault; else notDefault" class="ordering__default-status">
                            {{'addresses.main-address' | translate}}</p>
                          <ng-template #notDefault>
                            <button (click)="makeTheMainAddresses(item.id)"
                              class="ordering__change">{{'addresses.btn' | translate}}</button>
                          </ng-template>
                        </ng-container>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="ordering-delivery__add" *ngIf="fAddressCount < 3" (click)="addAddressForm()">
                    <div class="ordering-delivery__add-btn-Img"></div>
                    <div class="ordering-delivery__add-btn-add">{{'personal.addAddress' | translate }}</div>
                  </div>
              </div>
            </ng-container>
            <ng-container *ngIf="addingAddress">
              <h3 class="ordering-delivery__h3 ordering__h3">
                {{ 'personal.addingAddress' | translate }}
              </h3>
              <form class="ordering__addresses-form" [formGroup]="addressForm">
                <div class="ordering-delivery__city">
                  <ng-select id="regionId" (clear)="clearAddress()" (change)="chooseAddress()" class="ordering__select"
                    [items]="regions" [virtualScroll]="true" bindLabel="name" bindValue="id" formControlName="regionId"
                    [placeholder]=" 'personal.chooseRegion' | translate">
                  </ng-select>
                </div>
                <div class="ordering-delivery__city" *ngIf="cities.length > 0">
                  <ng-select id="cityId" (clear)="clearCity()" (change)="chooseCity()" class="ordering__select"
                    [items]="cities" [virtualScroll]="true" bindLabel="name" bindValue="id" formControlName="cityId"
                    [placeholder]=" 'personal.chooseCity' | translate">
                  </ng-select>
                </div>
                <ng-container *ngIf="addressForm.value.cityId && streets.length > 0">
                  <div class="ordering-delivery__street" *ngIf="addressForm.value.cityId && streets.length > 0">
                    <ng-select id="cityId" class="ordering__select" [items]="streets" [virtualScroll]="true"
                      bindLabel="name" bindValue="id" formControlName="streetId"
                      [placeholder]=" 'personal.chooseStreet' | translate">
                    </ng-select>
                  </div>
                  <div class="ordering-delivery__building">
                    <input type="text" id="deliveryBuilding" class="ordering__text-input" name="deliveryBuilding"
                      [placeholder]="'personal.house' | translate" formControlName="house">
                  </div>
                  <div class="ordering-delivery__appartment">
                    <input type="text" id="deliveryAppartment" class="ordering__text-input" name="deliveryAppartment"
                      [placeholder]=" 'personal.apartment2' | translate" formControlName="apartment">
                  </div>
                </ng-container>
              </form>
              <div class="ordering-delivery__add adding-adress">
                <div *ngIf="addressExist" class="ordering-delivery__error">
                  <span>{{'personal.addressExist' | translate }}</span>
                </div>
                <ng-container *ngIf="!addingData">
                  <button class="ordering-delivery__add-btn" *ngIf="addressForm.valid" (click)="addAddress()">
                    {{'personal.addAddress' | translate }}
                  </button>
                </ng-container>
                <ng-container *ngIf="addingData">
                  <div class="ordering-delivery__checking">
                    {{'personal.adding' | translate }}
                    <div><span>.</span><span>.</span><span>.</span></div>
                  </div>
                </ng-container>
                <button class="ordering-delivery__add-btn"
                  (click)="backToAddresses()">{{'personal.back' | translate }}</button>
              </div>
            </ng-container>
          </div>
          <div class="ordering__error" #errorOrderBlock *ngIf="errorOrder && choosenAddressId">
            <h3 class="ordering__h3">{{'order.errorOrder' | translate }}</h3>
          </div>
          <div class="ordering__error" #errorAddressBlock *ngIf="errorAddress && choosenAddressId">
            <h3 class="ordering__h3">{{'order.errorAddress' | translate }}</h3>
          </div>

          <div class="ordering-date__form-group" #orderingDateBlock *ngIf="schedule && !errorOrder && !errorAddress">
            <h3 class="ordering-date__h3 ordering__h3">
              {{'order.dateDelivery' | translate }}
              <span (mouseleave)="closeTooltip()" class="ordering-date__tooltip" #tooltip="tooltipDir"
                tooltip="{{ 'cart.tooltip' | translate}}" offsetLeft="5" placement="top" show-delay="300">

                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                  <g id="info">
                    <path id="circled-i"
                      d="M11.5 17a5.5 5.5 0 1 1 0-11 5.5 5.5 0 0 1 0 11zm0-12a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13zm.5 5v4h1v1h-3v-1h1v-3h-1v-1zm-1-2h1v1h-1z" />
                  </g>
                </svg>
              </span>
            </h3>
            <div class="ordering-date__input-group" *ngIf="isBrowser">
              <input type="text" (calendarToggle)="toggleCalendarEvent($event)" (focus)="dp.openCalendar()"
                (inputFieldChanged)="chooseDeliveryDate($event)" id="deliveryDate" class="ordering__text-input"
                [ngClass]="{'error' : !validDate}" name="deliveryDate"
                placeholder="{{ 'order.dayMonthYear' | translate}}" [options]="datePickerOptions" #dp="ngx-mydatepicker"
                autocomplete="off" ngx-mydatepicker>
              <!-- COMMENT FOR UX -->
              <!-- <button id="datePickerBtn" class="ordering-date__date-picker" (click)="dp.toggleCalendar()">
                <span class="ordering-date__btn-text">{{'order.chooseDate' | translate }}</span>
              </button> -->
            </div>
          </div>
          <div class="ordering-time__form-group" #orderingTimeBlock *ngIf="deliveryTimes?.length">
            <h3 class="ordering-time__h3 ordering__h3">
              {{'order.chooseTime' | translate }}
            </h3>
            <div class="ordering-time__or-group">
              <div class="ordering-time__or-wrap">
                <input id="deliveryAllDay" class="ordering-time__or-radio" [checked]="true" type="radio" value="all"
                  (change)="chooseTime('all')" formControlName="deliveryTime" name="deliveryTime">
                <label for="deliveryAllDay" class="ordering-time__or-label"></label>
              </div>
              <p class="ordering-time__or-text" for="deliveryAllDay">
                {{'order.allDay' | translate }}
              </p>
            </div>
            <div class="ordering-time__or-devider">{{'order.or' | translate }}</div>
            <div class="ordering-time__radio-group">
              <div class="ordering-time__input-group" *ngFor="let item of deliveryTimes; let i = index">
                <input [id]="i" class="ordering-time__radio-input" formControlName="deliveryTime" [value]="i"
                  (change)="chooseTime(item.timeFrom, item.timeTo)" type="radio" name="deliveryTime">
                <label [for]="i" class="ordering-time__radio-label">{{item.timeFrom}} - {{item.timeTo}}</label>
              </div>
            </div>
          </div>
          <div class="ordering-payment__form-group" #orderingPaymentBlock *ngIf="finalizeOrderForm.value.timeFrom">
            <h3 class="ordering-payment__h3 ordering__h3">
              {{'order.orderType' | translate }}
            </h3>
            <div class="ordering-payment__input-wrap">
              <div class="ordering-payment__input-group" *ngIf="!isUAddress">
                <input id="cashPayment" class="ordering-payment__radio-input" formControlName="orderType" value="1"
                  type="radio" name="orderType">
                <label for="cashPayment" class="ordering-payment__radio-label">{{'order.cash' | translate }}</label>
              </div>
              <div class="ordering-payment__input-group" *ngIf="isUAddress && canPayCourier">
                <input id="courierContract" class="ordering-payment__radio-input" formControlName="orderType" value="2"
                  type="radio" name="orderType">
                <label for="courierContract" class="ordering-payment__radio-label">{{'order.cash' | translate }}</label>
              </div>
              <div class="ordering-payment__input-group" *ngIf="!isUAddress || canPayEMoney">
                <input id="EMoney"  class="ordering-payment__radio-input" formControlName="orderType"
                  value="3" type="radio" name="orderType">
                <label for="EMoney" class="ordering-payment__radio-label">{{'order.cashLess' | translate }}</label>
              </div>
              <div class="ordering-payment__input-group" *ngIf="isUAddress && canPayCashless">
                <input id="cashless" class="ordering-payment__radio-input"
                  formControlName="orderType" value="4" type="radio" name="orderType">
                <label for="cashless" class="ordering-payment__radio-label">{{'order.nonCash' | translate }}</label>
              </div>
            </div>
          </div>
          <ng-container *ngIf="finalizeOrderForm.value.orderType">
            <div class="ordering-delivery__comment">
              <input id="deliveryComment" formControlName="comment"
                class="ordering-delivery__comment-input ordering__text-input" type="text" name="deliveryComment"
                placeholder="{{'order.comment' | translate }}" value="">
            </div>
            <div class="ordering-submit" #orderingSubmitBlock>
              <button *ngIf="!submiting; else sendingOrder" class="ordering-submit__btn" type="submit">
                <span class="ordering-submit__btn-text">{{'order.orderAdd' | translate }}</span>
              </button>
              <ng-template #sendingOrder>
                <div class="ordering-submit__sending">
                  <span class="ordering-submit__sending-text">{{'order.sendingOrder' | translate }}</span>
                </div>
              </ng-template>
            </div>
            <div class="ordering-agreement__form-group">
              <div class="ordering-agreement__input-group" #agreementBlock>
                <input id="orderAgreement" class="ordering-agreement__checkbox ordering-time__or-radio" type="checkbox"
                  name="orderAgreement"
                  [ngClass]="{ 'error': finalizeOrderForm.controls.agreement.value != true && finalizeOrderForm.controls.agreement.touched}"
                  formControlName="agreement">
                <label for="orderAgreement"
                  [class.pulse]="finalizeOrderForm.value.agreement != true && finalizeOrderForm.controls['agreement'].touched"
                  class="ordering-agreement__label ordering-time__or-label"></label>
              </div>
              <div class="ordering-agreement__text-wrap">
                <a class="ordering-agreement__text">{{'order.agreement' | translate }}
                  <a target="_blank" [routerLink]="['/agreements', 'public-sales-contract'] | localize"
                    class="ordering-agreement__red">{{'order.agreementLink' | translate }}</a>
                </a>
              </div>
            </div>
          </ng-container>

          <form #formLiq method="POST" action="https://www.liqpay.ua/api/3/checkout"
            accept-charset="utf-8">
            <input #data type="hidden" name="data" value="" />
            <input #signature type="hidden" name="signature" value="" />
            <!-- <input type="image" src="//static.liqpay.ua/buttons/p1ru.radius.png" /> -->
            <!-- <input type="submit" value="BUTTON" (click)="checkoutTest()" /> -->
          </form>
        </form>
      </section>
      <ngx-smart-modal class="modal" customClass="nsm-centered nsm-dialog-animation-fade" #userPrice
        identifier="userPrice">
        <div class="modal__price-wrap">
          <h5 class="modal__h5">{{'order.orderPrice' | translate }}:</h5>
          <div class="modal__price">
            <span class="modal__total">{{totalCartPrice}}</span>
            <span class="modal__currency">{{'shop.price' | translate }}</span>
          </div>
          <button (click)="userPrice.close()" class="ordering-submit__btn">
            <span class="ordering-submit__btn-text">{{'auth.continue' | translate }}</span>
          </button>
        </div>

        <!-- <button (click)="userPrice.close()">Close</button> -->
      </ngx-smart-modal>
      <section class="ordering__container-right">
        <div class="ordering__content-wrap">
          <h3 class="ordering-cart__h3 ordering__h3">
            {{'order.yourOrder' | translate }}
          </h3>
          <div class="ordering-cart__item" *ngFor="let item of cartItems; let i=index">
            <div class="ordering-cart__width">
              <div class="ordering-cart__wrap">
                <div class="ordering-cart__img-wrap">
                  <img class="ordering-cart__img" [src]="item.productPhoto" alt="order-image">
                </div>
                <div class="ordering-cart__description">
                  <div class="ordering-cart__title">
                    <p>{{ item.name}}</p>
                  </div>
                  <div class="ordering-cart__counter">
                    <span class="ordering-cart__counter-text">{{'personal.count' | translate }}:</span>
                    <span>{{ item.count }}</span>
                  </div>
                </div>
              </div>
              <div class="ordering-cart__price-wrap">
                <span class="ordering-cart__price">{{ item.productPrice }}</span>
                <span class="ordering-cart__currency">{{'order.currency' | translate }}</span>
              </div>
            </div>
          </div>
          <div class="ordering-cart__footer">
            <h5 class="ordering-cart__footer-h3 ordering__h3">{{'order.toPay' | translate }}</h5>
            <div class="ordering-cart__footer-price ordering-cart__price-wrap">
              <span class="ordering-cart__price">{{ totalCartPrice }}</span>
              <span class="ordering-cart__currency">{{'order.currency' | translate }}</span>
            </div>
          </div>
        </div>
        <div class="ordering__content-wrap" *ngIf="totalCartPrice != startPrice">
          <div class="ordering-cart__old">
            <h3 class="ordering-cart__old-h3">{{'order.startPrice' | translate }}</h3>
            <div class="">
              <span class="ordering-cart__price ordering-cart__old-price">{{startPrice}}
                {{'order.currency' | translate }}</span>
            </div>
          </div>

        </div>
      </section>
    </div>
  </div>

</div>
<div class="blocked-screen" *ngIf="eMoneyWaiting">

</div>
<app-our-clients></app-our-clients>
<app-subscribe></app-subscribe>
<app-delivery-water></app-delivery-water>